<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0"
		/>
		<title>Dynasoft Assignment</title>
		<link
			rel="stylesheet"
			href="./styles.css"
		/>
		<script
			type="text/javascript"
			src="Resources/dynamsoft.webtwain.initiate.js"
		></script>
		<script
			type="text/javascript"
			src="Resources/dynamsoft.webtwain.config.js"
		></script>
	</head>
	<body>
		<div class="container">
			<div id="dwtcontrolContainer"></div>
			<div>
				<div>
					Select Source
					<br />
					<select
						size="1"
						id="source"
						style="width: 200px"
					></select>
				</div>
				<div>
					<label>
						<input
							type="checkbox"
							id="ADF"
							checked="checked"
						/>Auto Feeder
					</label>
					<label>
						<input
							type="checkbox"
							id="ShowUI"
							checked="checked" />Show UI<br
					/></label>
				</div>
				<div>
					Pixel Type:
					<label for="BW"
						><input
							type="radio"
							id="BW"
							name="PixelType"
						/>B&amp;W
					</label>
					<label for="Gray"
						><input
							type="radio"
							id="Gray"
							name="PixelType"
						/>Gray</label
					>
					<label for="RGB"
						><input
							type="radio"
							id="RGB"
							name="PixelType"
							checked="checked"
						/>Color</label
					>
				</div>
				<div>
					Resolution:
					<select
						size="1"
						id="Resolution"
					>
						<option value="100">100</option>
						<option value="150">150</option>
						<option value="200">200</option>
						<option value="300">300</option>
					</select>
				</div>

				<input
					type="button"
					value="Scan"
					onclick="AcquireImage();"
				/>
				<input
					type="button"
					value="Save 1"
					onclick="SaveToLocalAsPdf();"
				/>
				<input
					type="button"
					value="Save 2"
					onclick="SaveToLocalAsPdfSingly();"
				/>
				<input
					type="button"
					value="Remove Blank Images"
					onclick="RemoveBlankImage();"
				/>
				<input
					type="button"
					value="Remove All Images"
					onclick="AcquireImage();"
				/>
			</div>
		</div>

		<script type="text/javascript">
			let DWObject, deviceList;
			function Dynamsoft_OnReady() {
				DWObject = Dynamsoft.DWT.GetWebTwain("dwtcontrolContainer");
				if (DWObject) {
					deviceList = [];
					DWObject.GetDevicesAsync()
						.then(function (devices) {
							for (let i = 0; i < devices.length; i++) {
								document
									.getElementById("source")
									.options.add(new Option(devices[i].displayName, i));
								deviceList.push(devices[i]);
							}
						})
						.catch(function (exp) {
							alert(exp.message);
						});
				}
			}
			function AcquireImage() {
				if (DWObject) {
					let i,
						iPixelType = 0;
					for (i = 0; i < 3; i++) {
						if (document.getElementsByName("PixelType").item(i).checked == true)
							iPixelType = i;
					}

					let ddlSource = document.getElementById("source");
					if (ddlSource) {
						DWObject.SelectDeviceAsync(deviceList[ddlSource.selectedIndex])
							.then(function () {
								return DWObject.AcquireImageAsync({
									IfShowUI: document.getElementById("ShowUI").checked,
									PixelType: iPixelType,
									Resolution: document.getElementById("Resolution").value,
									IfFeederEnabled: document.getElementById("ADF").checked,

									IfCloseSourceAfterAcquire: true,
								});
							})
							.catch(function (exp) {
								alert(exp.message);
							});
					}
				}
			}

			function OnSuccess() {
				console.log("successful");
			}
			function OnFailure(errorCode, errorString) {
				if (errorCode != -2326) {
					alert(errorString);
				}
			}

			function SaveToLocalAsPdf() {
				if (DWObject) {
					if (DWObject.HowManyImagesInBuffer > 0) {
						DWObject.IfShowFileDialog = true;
						DWObject.SaveAllAsPDF("result.pdf", OnSuccess, OnFailure);
						
					}
				}
			}

			function SaveToLocalAsPdfSingly() {
				DWObject.RegisterEvent(
					"OnGetFilePath",
					(isSave, filesCount, index, directory, _fn) => {
						if (directory === "" && _fn === "") {
							console.log("User cancelled the operation.");
						} else {
							var path = directory + "\\" + _fn.substr(0, _fn.lastIndexOf("."));
							DWObject.IfShowFileDialog = false;
							for (var i = 1; i < DWObject.HowManyImagesInBuffer; i++) {
								DWObject.SaveSelectedImagesAsMultiPagePDF(
									path + "_" + i.toString() + ".pdf",
									i,
									OnSuccess,
									OnFailure
								);
							}
						}
					}
				);
				DWObject.IfShowFileDialog = true;
				DWObject.SaveSelectedImagesAsMultiPagePDF(
					"Image",
					1,
					OnSuccess,
					OnFailure
				);
			}
		
      function RemoveBlankImage() {
        DWObject.RegisterEvent("OnPostTransferAsync", function () {
		    	let index = DWObject.CurrentImageIndexInBuffer;
		    	if (DWObject.IsBlankImage(index))
		       DWObject.RemoveImage(index);
		    });
      }
    </script>
	</body>
</html>
